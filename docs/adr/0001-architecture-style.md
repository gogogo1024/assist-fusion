# ADR-0001: 架构风格选择 —— 先模块化单体，后续按需拆分微服务

日期：2025-09-12
状态：已采纳（Accepted）

## 背景
当前项目包含 ticket-svc（已存在）、计划中的 kb-svc、ai-svc，以及以 Airflow 驱动的数据流程。目标是尽快交付可用的客服+AI MVP，并在业务验证后逐步扩展。

## 决策
采用“模块化单体（Modular Monolith）优先”的策略：
- 在同一代码库/进程内以清晰的模块边界实现 ticket、kb、ai 能力；对外可先以单一二进制提供 HTTP 接口。
- 通过内部接口抽象（例如 internal/... 包路径、接口定义、领域分层）保持未来可拆分性。
- 当达到拆分阈值（见下）时，再按域或吞吐拆为独立微服务。

## 拆分阈值（建议）
- 吞吐/资源：某模块 CPU/内存/连接数占比 > 60%，或独立扩缩容需求明显。
- 变更速率：发布频率明显高于其他模块，导致耦合发布成本过高。
- 团队边界：有专职小组负责该域，协作冲突和认知负担升高。
- 故障隔离：该模块故障对整体影响显著，需强隔离与独立SLA。

## 依据与权衡
- 交付速度：单体更快落地 MVP，减少服务间通信、部署与观测的复杂度。
- 成本与风险：避免“为微服务而微服务”，优先聚焦业务价值与稳定性。
- 可演进性：通过接口与包边界、mise 任务、README/ADR，预留服务化所需的结构与文档。

## 实施要点（建议）
- 代码结构：`internal/<domain>` + `services/<entry>`，借助接口隐藏实现细节。
- 运行入口：保留单进程模式，同时支持按模块启动（未来拆服务的雏形）。
- 观测：统一日志与 request-id；未来可加入 tracing 与 metrics。
- 数据：先内存与文件为主，后续按需要换成外部存储/向量库。

## 备选方案
- 直接微服务化（多个进程）：初期成本高，涉及网关、注册发现、链路追踪、CI/CD复杂度提升；不利于 MVP 速度。

## 结论
先模块化单体，等达到拆分阈值再做服务化演进；期间用 Airflow 管流程编排，不强行分散运行时边界。
